<!DOCTYPE html>
<html>
<head>
    <title>Autonomous Dashboard</title>
    
    <!-- using locally hosted roslib and fonts -->
    <!-- <link rel="stylesheet" type="text/css" href="http://localhost:8000/asset/styles.css"> -->
    <link rel="stylesheet" type="text/css" href="asset/styles.css">
    <script type="text/javascript" src="http://localhost:8000/asset/roslib.min.js"></script>

</head>
<body>
    <div class="header">
        <div class="header-one">
            <label><b>Autonomous Mission</b></label> 
        </div>
        <div class="header-two">
            <img class="logo" src="asset/UMRT new logo.png" alt="">
        </div>
    </div>
    

    <div class="main">
        
            <!-- <label><b>AUTONOMOUS DASHBOARD</b></label>  -->
            
        

        <div class="container">
            
            <div class="column-container">
              <div class="one"></div>
              <div class="two"></div>
            </div>
            <div class="side-by-side-div">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3650.5823360348827!2d90.44713507620115!3d23.797882878638!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3755c7d8042caf2d%3A0x686fa3e360361ddf!2sUnited%20International%20University!5e0!3m2!1sen!2sbd!4v1699432182382!5m2!1sen!2sbd" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            
           
        </div>

        <div class="point-table">
            <table class="point">
                <tr>
                    <th>Point 0</th>
                    <td><div id="one">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 1</th>
                    <td><div id="two">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 2</th>
                    <td><div id="three">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 3</th>
                    <td><div id="four">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 4</th>
                    <td><div id="five">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 5</th>
                    <td><div id="six">N/A</div></td>
                </tr>
                <tr>
                    <th>Point 6</th>
                    <td><div id="seven">N/A</div></td>
                </tr>
            </table>
        </div>

        <div class="table-two">
            <table class="point-two">
                <tr>
                    <th>Post 1</th>
                    <td>
                        <div id="Post1Lat">N/A</div>
                        <div id="Post1Lon">N/A</div>
                    </td>
                </tr>
                <tr>
                    <th>Post 2</th>
                    <td>
                        <div id="Post2Lat">N/A</div>
                        <div id="Post2Lon">N/A</div>           
                    </td>
                </tr>
                <tr>
                    <th>Post 3</th>
                    <td>
                        <div id="Post3Lat">N/A</div>
                        <div id="Post3Lon">N/A</div>
                    </td>
                </tr>
                <tr>
                    <th>Obj 1</th>
                    <td>
                        <div id="Obj1Lat">N/A</div>
                        <div id="Obj1Lon">N/A</div>
                    </td>
                </tr>
                <tr>
                    <th>Obj 2</th>
                    <td>
                        <div id="Obj2Lat">N/A</div>
                        <div id="Obj2Lon">N/A</div>
                    </td>
                </tr>
            </table>
        </div>

        <div class="status">

            <table class="autonomous">
                <tr>
                    <th class="autoHead">MODE</th>
                    <td class="autoRow"><div id="autonomous">N/A</div></td>
                </tr>
    
            </table>
            
            <div class="light" id="light"></div>
    
            <table class="linvelocity"> 
                <tr>
                    <th class="autoHead">Linear Vel</th>
                    <td class="autoRow"><div id="linear">N/A</div></td>
                </tr>
            </table>
    
            <table class="angvelocity">
                <tr>
                    <th class="autoHead">Angular Vel</th>
                    <td class="autoRow"><div id="angular">N/A</div></td>
                </tr>
            </table>
    
        </div>

    </div>


    <script>
        

        const Div1 = document.getElementById("one");
        const Div2 = document.getElementById("two");
        const Div3 = document.getElementById("three");
        const Div4 = document.getElementById("four");
        const Div5 = document.getElementById("five");
        const Div6 = document.getElementById("six");
        const Div7 = document.getElementById("seven");

        const linveldiv= document.getElementById("linear");  
        const angularveldiv= document.getElementById("angular");

        let latitude = 0;
        let longitude = 0;


        
        var light = document.getElementById("light");
        var isBlinking = false;


        // Create a ROS connection
        const ros = new ROSLIB.Ros({
            url: 'ws://localhost:9090',  // Adjust the URL to match your ROSBridge server address.
        });

        const velListener = new ROSLIB.Topic({
            ros: ros,
            name: '/cmd_vel', // velocity topic
            messageType: 'geometry_msgs/Twist',
        });

        const navsatfixListener = new ROSLIB.Topic({
            ros: ros,
            name: '/nav_sat', // navSatFix message
            messageType: 'sensor_msgs/NavSatFix'
        });

        // Define a ROS subscriber
        const indicatorListener = new ROSLIB.Topic({
            ros: ros,
            name: '/indicator', // indicator message
            messageType: 'std_msgs/String',
        });

        velListener.subscribe(function(message) {
            const linearvel = message.linear.x.toFixed(3);         
            const angularvel = message.angular.z.toFixed(3);
            linveldiv.style.color = "black";
            angularveldiv.style.color = "black";
            linveldiv.innerHTML =  linearvel + " m/s";
            angularveldiv.innerHTML =  angularvel + " m/s";
        });


        navsatfixListener.subscribe(function(message) {
            latitude = message.latitude.toFixed(7);         
            longitude = message.longitude.toFixed(7);
            // console.log(latitude);
            // console.log(longitude);
        });

        

        // Listen for messages from the ROS topic
        indicatorListener.subscribe(function(message) {
            

            const text = message.data;
            

            console.log(message.data);

            if (text === "RED -> Autonomous Mode") {
                light.style.backgroundColor = "red";
                autonomous.innerHTML = "AUTONOMOUS";
                autonomous.style.color = "red";
                stopBlinking();

            } else if (text === "Blue -> Manual Mode") {
                autonomous.innerHTML = "MANUAL";
                autonomous.style.color = "blue";
                light.style.backgroundColor = "#135DD8";
                stopBlinkingGreen();

            }
            else if (text === "Point Reached: 0") {
                Div1.innerHTML = "Reached"; 
                Div1.style.color = "green"; // make the text bold
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 1") {
                Div2.innerHTML = "Reached";
                Div2.style.color = "green";
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 2") {
                Div3.innerHTML = "Reached";
                Div3.style.color = "green";
                // save post coordinate (required for autonomous course restart) by reading current /nav_sat data
                Post1Lat.innerHTML = `${latitude}`;
                Post1Lon.innerHTML = `${longitude}`;
                // console.log(`${latitude}`);
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 3") {
                Div4.innerHTML = "Reached";
                Div4.style.color = "green";
                // save post coordinate (required for autonomous course restart) by reading current /nav_sat data
                Post2Lat.innerHTML = `${latitude}`;
                Post2Lon.innerHTML = `${longitude}`;
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 4") {
                Div5.innerHTML = "Reached";
                Div5.style.color = "green";
                Post3Lat.innerHTML = `${latitude}`;
                Post3Lon.innerHTML = `${longitude}`;
                // save post coordinate (required for autonomous course restart) by reading current /nav_sat data
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 5") {
                Div6.innerHTML = "Reached";
                Div6.style.color = "green";
                // save post coordinate (required for autonomous course restart) by reading current /nav_sat datasave post coordinate by reading current /nav_sat data
                Obj1Lat.innerHTML = `${latitude}`;
                Obj1Lon.innerHTML = `${longitude}`;
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }
            else if (text === "Point Reached: 6") {
                Div7.innerHTML = "Reached";
                Div7.style.color = "green";
                // save post coordinate (required for autonomous course restart) by reading current /nav_sat data
                Obj2Lat.innerHTML = `${latitude}`;
                Obj2Lon.innerHTML = `${longitude}`;
                if(isBlinking == false){
                    startBlinking();
                }
                else if(isBlinking == true){
                    console.log(isBlinking);
                }
            }

            function startBlinking() {
            isBlinking = true;
            light.style.backgroundColor = "green";
            blinkInterval = setInterval(function () {
                if (light.style.backgroundColor === "green") {
                    light.style.backgroundColor = "transparent";
                } else {
                    light.style.backgroundColor = "green";
                }
            }, 500); // Blink every 500ms
        }

        function stopBlinking() {
                light.style.backgroundColor = "red";
                clearInterval(blinkInterval); // Clear the interval to stop blinking
                isBlinking = false;
            }

        function stopBlinkingGreen() {
            light.style.backgroundColor = "#135DD8";
            clearInterval(blinkInterval); // Clear the interval to stop blinking
            isBlinking = false;
        }

        });

        

    </script>
</body>
</html>
